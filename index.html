<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body,
        html {
            width: 100vw;
            height: 100vh;
            padding: 0;
            margin: 0;
            font-family: 'Inter', sans-serif;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            padding: 0;
            margin: 0;
        }

        .background {
            background: url(https://source.unsplash.com/random/?nature) no-repeat center center fixed;
            background-size: cover;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: stretch;
            background: #00000088;
            backdrop-filter: blur(10px);
        }

        .content {
            margin: 0 auto;
            max-width: 1200px;
        }

        .greeting {
            width: 100%;
            text-align: center;
            margin-bottom: 24px;
        }

        .greeting h2 {
            color: white;
            font-size: 98px;
        }

        .info-row {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .info-weather {
            width: 200px;
            flex-grow: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .info-weather p {
            font-size: 20px;
            color: white;
        }

        .info-weather svg {
            width: 100px;
            height: 100px;
            color: white;
        }

        .info-time {
            text-align: center;
        }

        .info-time h3 {
            font-size: 72px;
            color: white;
        }

        .info-time p {
            font-size: 20px;
            padding: 0;
            margin: 0;
            color: white;
        }
    </style>

</head>

<body>
    <div class="background">
        <div class="container">
            <div class="content">
                <div id="greeting" class="greeting">
                    <h2 id="time-greeting"></h2>
                </div>
                <div class="info-row">
                    <div class="info-weather">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-cloud-snow"
                            width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                            fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <path d="M7 18a4.6 4.4 0 0 1 0 -9a5 4.5 0 0 1 11 2h1a3.5 3.5 0 0 1 0 7" />
                            <path d="M11 15v.01m0 3v.01m0 3v.01m4 -4v.01m0 3v.01" />
                        </svg>
                        <p>Snowy</p>
                    </div>
                    <div class="info-time">
                        <h3></h3>
                        <p></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Constants
        const API_KEY = "14dc36f2c6730ae72098fc0579cca033";
        const DEFAULT_COORDINATES = { lat: 0, lon: 0 };

        function getCurrentPosition() {
            return new Promise((resolve, reject) => {
                navigator.geolocation.getCurrentPosition(resolve, reject);
            });
        }

        async function getCoordinates() {
            try {
                const position = await getCurrentPosition();
                return {
                    lat: position.coords.latitude,
                    lon: position.coords.longitude
                };
            } catch (error) {
                alert("Could not get current location for weather data.");
                return DEFAULT_COORDINATES;
            }
        }

        // Async/await
        async function getWeatherData() {
            const { lat, lon } = await getCoordinates();
            const response = await fetch(`https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&exclude=daily,alerts&appid=${API_KEY}`);
            const data = await response.json();
            console.log(data)
            return data;
        }

        // Date and Time Functions
        function getTimeGreeting() {
            const hours = new Date().getHours();
            if (hours < 5) return 'Night';
            if (hours < 12) return 'Morning';
            if (hours < 18) return 'Afternoon';
            return 'Evening';
        }

        function getCurrentTime() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')} ${hours >= 12 ? 'PM' : 'AM'}`;
        }

        function getMonthWord(monthNumber) {
            const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            return months[monthNumber - 1] || 'undefined';
        }

        function getCurrentDate() {
            const now = new Date();
            const day = now.getDate();
            const month = now.getMonth() + 1;
            const year = now.getFullYear();
            return `${getMonthWord(month)} ${day}, ${year}`;
        }

        // State Management with Closures
        function createState(initialValue) {
            let value = initialValue;
            const subscribers = [];
            return {
                get value() { return value; },
                set value(newValue) {
                    if (newValue === value) return;
                    value = newValue;
                    subscribers.forEach(subscriber => subscriber(value));
                },
                subscribe(subscriber) {
                    subscribers.push(subscriber);
                    subscriber(value);
                }
            };
        }

        // DOM Manipulation
        function updateDOMElements() {
            const timeGreetingElement = document.getElementById("time-greeting");
            const timeElement = document.querySelector(".info-time h3");
            const dateElement = document.querySelector(".info-time p");

            const greeting = createState(`Good ${getTimeGreeting()}, John`);
            const time = createState(getCurrentTime());
            const date = createState(getCurrentDate());

            greeting.subscribe(value => timeGreetingElement.innerText = value);
            time.subscribe(value => timeElement.innerText = value);
            date.subscribe(value => dateElement.innerText = value);

            setInterval(() => {
                greeting.value = `Good ${getTimeGreeting()}, John`;
                time.value = getCurrentTime();
                date.value = getCurrentDate();
            }, 1000);

            getWeatherData();
        }

        updateDOMElements();
    </script>
</body>

</html>